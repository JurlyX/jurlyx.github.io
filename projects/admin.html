<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MaddoxJ Kitchen - Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
body { background: #fff5f0; color: #333; padding: 20px; }
header { text-align: center; margin-bottom: 30px; }
header h1 { font-size: 3em; color: #ff5722; }
header p { font-size: 1.2em; color: #555; }

.orders { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
.order-card { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; transition: transform 0.3s; }
.order-card.complete { border-left: 5px solid green; transform: scale(1.02); }
.order-card h3 { color: #ff5722; margin-bottom: 10px; }
.order-card ul { list-style: none; padding: 0; margin-bottom: 10px; }
.order-card li { margin-bottom: 5px; }
.order-card button { margin-top: 10px; padding: 8px; border: none; border-radius: 10px; background: #ff5722; color: #fff; cursor: pointer; transition: background 0.2s; }
.order-card button:hover { background: #e64a19; }
button + button { margin-left: 10px; }
</style>
</head>
<body>

<header>
  <h1>MaddoxJ Kitchen - Admin</h1>
  <p>Manage incoming orders</p>
</header>

<div class="orders" id="ordersList"></div>

<script>
const BIN_ID = "68e6739e43b1c97be95ee60e";
const API_KEY = "$2a$10$w7kHZII5PZ.x1MhtZTBQm.WFZP1ZkfvsbDscb/WNBo9.0kmDtxgH.";

// Fetch the orders from JSONBin
async function fetchOrders() {
  try {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: { "X-Master-Key": API_KEY }
    });
    const data = await res.json();
    // Make sure we always get an array
    if (!data.record) return [];
    return Array.isArray(data.record) ? data.record : [data.record];
  } catch (err) {
    console.error("Error fetching orders:", err);
    return [];
  }
}

// Render the orders as cards
async function loadOrders() {
  const orders = await fetchOrders();
  const container = document.getElementById('ordersList');
  container.innerHTML = '';

  if (orders.length === 0) {
    container.innerHTML = '<p>No orders yet.</p>';
    return;
  }

  orders.forEach(order => {
    const card = document.createElement('div');
    card.className = 'order-card' + (order.complete ? ' complete' : '');

    const title = document.createElement('h3');
    title.textContent = order.name || "Unnamed";
    card.appendChild(title);

    const ul = document.createElement('ul');
    if (Array.isArray(order.order)) {
      order.order.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        ul.appendChild(li);
      });
    }
    card.appendChild(ul);

    const completeBtn = document.createElement('button');
    completeBtn.textContent = order.complete ? 'Mark Incomplete' : 'Mark Complete';
    completeBtn.onclick = () => toggleComplete(order.id);
    card.appendChild(completeBtn);

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.onclick = () => deleteOrder(order.id);
    card.appendChild(deleteBtn);

    container.appendChild(card);
  });
}

// Update JSONBin
async function updateOrders(newOrders) {
  try {
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method: 'PUT',
      headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
      body: JSON.stringify(newOrders)
    });
    loadOrders();
  } catch (err) {
    console.error("Error updating orders:", err);
  }
}

// Toggle complete
async function toggleComplete(id) {
  const orders = await fetchOrders();
  const updated = orders.map(o => o.id === id ? {...o, complete: !o.complete} : o);
  updateOrders(updated);
}

// Delete order
async function deleteOrder(id) {
  const orders = await fetchOrders();
  const updated = orders.filter(o => o.id !== id);
  updateOrders(updated);
}

// Initial load + refresh every 5s
loadOrders();
setInterval(loadOrders, 5000);
</script>

</body>
</html>
